# lima-vm.yaml
# Specify the architecture of the VM.
# Can be "x86_64" or "aarch64".
# It's best to match the architecture of your host machine.
arch: "aarch64"

# The 'images' section is where you define the base disk for your VM.
images:
  - location: "./output/qcow2/disk.qcow2"
cpus: 2
memory: "4GiB"
disk: "30GiB"

portForwards:
  # HTTP port
  - guestPort: 80
    hostPort: 8080
  # OpenCode server
  - guestPort: 8081
    hostPort: 8081
  # HTTPS port
  - guestPort: 443
    hostPort: 8443

# use "qemu" on linux for better performance
vmType: "vz"

# Mount host directories using virtiofs (required for vz)
mountType: "virtiofs"
mounts:
  - location: "/Users/cverna/Documents/Fedora"
    mountPoint: "/var/workspace"
    writable: true
  - location: "/Users/cverna/.config"
    mountPoint: "/var/home/cverna/.config"
    writable: true

# Use the cverna user from the image with correct home directory
user:
  name: cverna
  uid: 1000
  home: /var/home/cverna

# /usr/local/bin is read-only, so let's point it to /var/usrlocal/bin instead. 
provision:
- mode: boot
  script: |
    #!/bin/bash
    set -eux -o pipefail
    mkdir -p /var/usrlocal/bin
    # Fix ownership of cverna home directory
    chown -R cverna:cverna /var/home/cverna
env:
  LIMA_CIDATA_GUEST_INSTALL_PREFIX: /var/usrlocal

# Turn off containerd.
containerd:
  system: false
  user: false